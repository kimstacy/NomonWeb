<!DOCTYPE html>
<html>
    <title>Final Questionnaire</title>
    <link rel="icon"
    type="image/png"
    href="../icon.png">
<head>
<style>
p {
    font-size: 20px;
}

.likert li {
  float: left;
  list-style-type: none;
  text-align: center;
  margin-right: 30px;
  margin-left: 30px;
}

textarea {
    font-family: "Lucida Console", Monaco;
    font-size: 20pt ;
    width: 60%;
    height: 200px;
}
.btn {
  border: none;
  color: white;
  padding: 5px 15px;
  text-align: center;
  text-decoration: none;
  display: inline-block;
  font-family: Helvetica, sans-serif;
  font-size: 1.1vw ;
  margin: 1px 1px;
  cursor: pointer;
  border-radius: 4px;
}
.clickable {
    background-color: #0056ff;
}
.unclickable {
    background-color: rgba(0, 89, 255, 0.32);
}
</style>
<body>
    <h1><b>Final Questionnaire</b></h1>
    <h2>Participant: <span id="user_id_text">?</span><br>
        Condition: Keyboard <span id="condition_text">?</span><br>
        Order: <span id="order_text">?</span><br>
        Session Number: <span id="session_text">?</span></h2>

    <h3>The questions on this page refer to the experimental condition you just completed.<br>
    How much do you agree or disagree with the following statements:</h3>


    <p><b>1)</b> If you had to choose between the two methods used in this study to enter <span id="question_specific">Text</span>, which would you
prefer? (only check one):</p>
    <ul class="likert">
        <li><input type="radio" onclick="allow_submit();" name="q1" value="1" /><br>
        Keyboard A (Clocks)</li>

        <li><input type="radio" onclick="allow_submit();" name="q1" value="2" /><br>
        Keyboard B (Grid)</li>
        <br>
    </ul>
    <br>

    <div>
        <br><p>Please explain why you chose this method over the other method: <i>*required*</i></p>
        <textarea id="fr_1"></textarea>
    </div>
    <div>
        <br><p>In the space below, please share any final comments you may have about this study or the
experimental interface used in it:</p>
        <textarea id="fr_2"></textarea>
    </div>

    <input class='btn unclickable' type="button" id = "submit_button" value = "Submit"/>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript">
    const params = new URLSearchParams(document.location.search);
    const user_id = params.get("user_id");
    const condition = params.get("condition");
    const session = params.get("session");
    const partial_session = params.get("partial_session") === 'true';
    console.log(partial_session);
    const order = 1 + (partial_session | 0);
    const tlx = params.get("tlx");

    var user_id_header = document.getElementById("user_id_text");
    user_id_header.innerHTML = user_id;
    var condition_header = document.getElementById("condition_text");
    condition_header.innerHTML = condition;
    var order_header = document.getElementById("order_text");
    order_header.innerHTML = order;
    var session_header = document.getElementById("session_text");
    session_header.innerHTML = session;

    if (parseInt(session) === 10){
        var question_specific = document.getElementById("question_specific");
        question_specific.innerHTML = `<b> EMOJIS </b>`;
    }



    var response_box_1 = document.getElementById("fr_1");
    var response_box_2 = document.getElementById("fr_2");
    response_box_1.oninput = function() {
        allow_submit();
    }

    send_button = document.getElementById("submit_button");

    function allow_submit(){
        var q1_checked = document.querySelector('input[name="q1"]:checked') != null;

        if (q1_checked && response_box_1.value !== ""){
            send_button.onclick = send_data;
            send_button.className = 'btn clickable'
        }
    }

    function send_data(){ // jshint ignore:line
        post_data = {};
        post_data["user_id"] = user_id;
        post_data["condition"] = condition;
        post_data["order"] = order;
        post_data["session"] = session;

        post_data["q1"] = document.querySelector('input[name="q1"]:checked').value;

        var fr_1_text = response_box_1.value;
        post_data["fr1"] = fr_1_text.replace(new RegExp("'", "g"), "8");
        var fr_2_text = response_box_2.value;
        post_data["fr2"] = fr_2_text.replace(new RegExp("'", "g"), "8");
        console.log(post_data);

        $.ajax({
            method: "POST",
            url: "../php/send_survey_final.php",
            data: post_data
        }).done(function (data) {
            var result = data;
            console.log(result);

            var url;
            if (tlx === "full") {
                url = "../html/tlx.html".concat('?user_id=', user_id.toString(),
                    '&condition=', condition,'&session=', session.toString(), '&partial_session=',
                    partial_session.toString(), "&full=true");
                window.open(url, "_self");
            } else if (tlx === "short"){
                url = "../html/tlx.html".concat('?user_id=', user_id.toString(),
                    '&condition=', condition, '&session=', session.toString(), '&partial_session=',
                    partial_session.toString(), "&full=false");
                window.open(url, "_self");
            } else {
                // window.close();
            }
        });
    }

</script>
</body>
</html>